<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="stylesheets/nv.d3.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.js" charset="utf-8"></script>
    <script src="javascripts/nv.d3.js"></script>

    <style>
        text {
            font: 12px sans-serif;
        }
        svg {
            display: block;
        }
        html, body, #chart, svg {
            margin: 0px;
            padding: 0px;
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>

<div id="chart" class='with-3d-shadow with-transitions'>
    <svg></svg>
</div>

<script>

		d3.json('/node/api/nvd3/temperature', function(error, data) {	
		  	if (error) return console.log(error);
  			console.log(data);
  			
            var nested_data = d3.nest()
                                .key(function(d) { return d.name; })
                                .entries(data);
            
			nv.addGraph(function() {
                var chart = nv.models.lineWithFocusChart();

                // mapear x e y hacia las columnas
                chart.x(function(d) {
                    var b = new Date(d.timestamp).getTime();
                    return b;
                });
                chart.y(function(d) { return d.value; });
                
                // formato ejes
                chart.xAxis.tickFormat(function (d) {
                    var a = new Date(d);
                    return d3.time.format('%a %d %H:%M:%S')(a);
                })
                .axisLabel("tiempo");
                chart.x2Axis.tickFormat(function (d) {
                    return d3.time.format('%d/%m %H:%M:%S')(new Date(d));
                });

                chart.yTickFormat(d3.format(',.1f'));
                chart.yAxis.axisLabel("ÂºC");
                
                chart.interpolate("basis");

                chart.useInteractiveGuideline(true);

                d3.select('#chart svg')
                    .datum(nested_data)
                    .call(chart);

                nv.utils.windowResize(chart.update);

                return chart;
		  });
        });

</script>
</body>
</html>
